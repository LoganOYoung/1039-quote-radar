# 成本和报价计算器：准确 + 实时 — 建议方案

目标：**准确**（公式对、参数可校准）、**实时**（输入即算、能实时的数据尽量实时），同时不承诺无法兑现的「全自动实时运价」。

---

## 一、准确：怎么做才靠谱

### 1. 公式透明、可校验

- 所有计算步骤在界面或「计算说明」里写清楚，例如：  
  `FOB = (EXW + 代理费 + 国内段 + 利润) / (汇率 × 0.998)`  
  `计费重 = max(实重, 体积重)`、`体积重 = L×W×H / 系数`。
- 提供「成本明细」展示：EXW、代理费、国内段、利润、汇率、结汇系数，用户可逐项核对。

### 2. 参数可配置、可覆盖

- **系统级默认**（env 或后台配置，便于不同客户/线路调参）：  
  代理费、义乌拖车价、计费系数（6000/5000）、结汇系数 0.998。  
  当前写死的 80、120 等改为从配置读，便于校准。
- **单次覆盖**：新建报价时允许用户改「本次代理费」「本次国内段」等，适合特殊一单。
- **发货地**：已支持「义乌发出 / 工厂直发」，工厂直发时国内段用户填或 0。

### 3. 明确「谁负责准确」

- **系统负责**：公式正确、加减乘除无误、参数可配置可填。
- **用户/货代负责**：EXW 单价、国内段单价（元/吨、元/CBM）、到港运费、目的港费用等——系统不自动拉运价，只按用户输入算。  
  文案示例：「国内成本与 FOB 由本工具按您输入的数据计算；国际段运费与目的港费用请以货代报价为准。」

### 4. 能实时的尽量实时

- **前端**：所有输入（EXW、利润率、汇率、箱规、重量、国内段单价等）**输入即算**，无需点「计算」才刷新（当前已有 FOB 预估，可扩展到成本明细、计费重、体积重等）。
- **汇率**：唯一建议接的「实时」数据——用免费/低成本 API（如 exchangerate-api、央行或银行公开接口）拉取「人民币对美元」作为默认汇率，用户仍可覆盖。这样既「实时」又「可校准」。
- **运价**：不做实时 API 拉取（数据源少、成本高、维护难）。改为：  
  - 用户询价后**手动输入**「到港运费」或「CIF 总价」；  
  - 或提供「上次使用」的默认值（存在 localStorage 或用户设置），减少重复输入，但标注「仅供参考，以货代为准」。

---

## 二、实时：哪些做、哪些不做

| 项目           | 是否做「实时」 | 做法 |
|----------------|----------------|------|
| 输入即算       | ✅ 做           | 所有字段 onChange 即重算 FOB、成本明细、计费重/体积重，无需点按钮。 |
| 汇率           | ✅ 建议做       | 页面加载或「刷新汇率」时调 API 取最新人民币/美元，作为默认值；用户可改。 |
| 国内段单价     | ❌ 不做自动拉取 | 用户输入或选「常用预设」（预设人工维护）。 |
| 海/空运到港价  | ❌ 不做自动拉取 | 用户输入货代报价；可选「记住上次」做默认值。 |
| 目的港杂费     | ❌ 不做自动拉取 | 用户输入或留空。 |

这样「实时」只用在**确实可获取且稳定**的数据（汇率 + 前端即时计算），其余用**用户输入 + 可选记忆**，既准确又可持续。

---

## 三、产品形态建议（不增加必要复杂度）

1. **分步 / 折叠**
   - **第一步**：产品名、EXW、箱规（长宽高）、毛重/净重 → 自动算体积、体积重、计费重，并提示重货/抛货。
   - **第二步**：发货地（义乌/工厂直发）、国内段（按重/按体积/按柜 + 单价，或固定 120）、利润率、汇率 → 实时出 FOB 与成本明细。
   - **第三步（可选）**：目的港下拉（仅列表）、用户填「到港运费」或「CIF 总价」→ 展示到港价或 CIF；文案写清「国际段以货代为准」。

2. **场景切换**
   - **简单报价**：只填 EXW + 利润率 + 汇率（+ 发货地），用现有逻辑，不展示箱规/重量。
   - **带箱规与国内段**：展开箱规、重量、国内段计费方式，适合需要算「按重/按方」成本的单。
   - **带到港价**：在 FOB 基础上加「目的港 + 用户填的运费」，只做汇总展示。

3. **单位与默认值**
   - 单位固定或下拉选择，旁边灰色小字标注「单位：kg」「单位：元/吨」等。
   - 关键结果（FOB USD、计费重、成本明细）大号或高亮，减少看错。

---

## 四、实现优先级（建议）

| 阶段   | 内容 | 准确 | 实时 |
|--------|------|------|------|
| **Phase 1** | 参数可配置：代理费、拖车、计费系数、结汇系数从 env 或配置读；成本明细展示（EXW、代理、国内段、利润、汇率、FOB）。 | ✅ 可校准 | 输入即算 ✅ |
| **Phase 2** | 汇率默认值：接入汇率 API，加载或刷新时更新默认汇率，用户可覆盖。 | ✅ 默认更贴近市场 | 汇率可实时 ✅ |
| **Phase 3** | 箱规+重量：长宽高→体积/体积重；毛净重→计费重；重/抛提示；国内段「按重/按体积/按柜」+ 单价，参与 FOB。 | ✅ 公式完整 | 输入即算 ✅ |
| **Phase 4** | 目的港列表 + 「到港运费」用户输入 → FOB + 运费 = 到港价；可选「记住上次运费」做默认值。 | ✅ 边界清晰 | 不接运价 API，用用户输入 |

**不做 / 延后**：自动拉取海运/空运实时运价、AI 自动判断按重/按体积、对接货代系统。

---

## 五、一句话总结

- **准确**：公式透明、参数可配置可覆盖、成本明细可见；运价与目的港费由用户/货代输入，系统不「猜」。
- **实时**：前端**输入即算**；**汇率**用 API 做默认实时；**运价**不做实时拉取，用用户输入 + 可选「上次值」。
- 这样计算器在可控范围内做到**准确且可校准**，在可行范围内做到**实时**，同时不承诺无法实现的「全自动实时运价」。
